<!-- blog/templates/blog/post_search.html -->
{% extends "blog/base.html" %}
{% load static %}

{% block title %}Search Results - Django Blog{% endblock %}

{% block content %}
<div class="search-container">
    <h1>Search Posts</h1>

    <!-- Search Form -->
    <form method="get" action="{% url 'post_search' %}" class="search-form">
        <div class="search-box">
            <input type="text" name="q" value="{{ query }}" placeholder="Search by title, content, author, or tags..."
                class="search-input" autofocus>
            <button type="submit" class="btn btn-primary">Search</button>
        </div>
    </form>

    <!-- Results -->
    {% if query %}
    <h2>
        Search results for "{{ query }}"
        <span class="result-count">{{ posts.count }} result{{ posts.count|pluralize }}</span>
    </h2>

    {% if posts %}
    <div class="posts-list">
        {% for post in posts %}
        <article class="post-card">
            <h2 class="post-title">
                <a href="{% url 'post_detail' post.id %}">
                    {{ post.title }}
                </a>
            </h2>

            <div class="post-meta">
                <span class="post-author">
                    By {{ post.author.username }}
                </span>
                <span class="post-date">
                    {{ post.published_date|date:"F j, Y" }}
                </span>
            </div>

            <!-- Highlight search terms in excerpt -->
            <div class="post-excerpt">
                {{ post.content|truncatewords:50 }}
            </div>

            <!-- Tags -->
            {% if post.tags.all %}
            <div class="post-tags">
                <span>Tags:</span>
                {% for tag in post.tags.all %}
                <a href="{% url 'tag_detail' tag.slug %}" class="tag-badge">
                    {{ tag.name }}
                </a>
                {% endfor %}
            </div>
            {% endif %}

            <a href="{% url 'post_detail' post.id %}" class="btn">
                Read More →
            </a>
        </article>
        {% endfor %}
    </div>

    <!-- Pagination -->
    {% if is_paginated %}
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
            <a href="?q={{ query }}&page=1">&laquo; first</a>
            <a href="?q={{ query }}&page={{ page_obj.previous_page_number }}">
                previous
            </a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
            <a href="?q={{ query }}&page={{ page_obj.next_page_number }}">
                next
            </a>
            <a href="?q={{ query }}&page={{ page_obj.paginator.num_pages }}">
                last &raquo;
            </a>
            {% endif %}
        </span>
    </div>
    {% endif %}

    {% else %}
    <p class="no-results">No posts found matching "{{ query }}".</p>
    {% endif %}
    {% endif %}

    <!-- Back to all posts -->
    <div class="back-link">
        <a href="{% url 'post_list' %}">← View All Posts</a>
    </div>
</div>
{% endblock %}